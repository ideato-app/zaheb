async function fetchServicesData() {
    try {
        console.log("Processing services page data...");

        // Use the provided API response directly instead of fetching
        const docsData = {
            "page": 1,
            "results_per_page": 20,
            "results_size": 4,
            "total_results_size": 4,
            "total_pages": 1,
            "next_page": null,
            "prev_page": null,
            "results": [
                {
                    "id": "aEXc6hUAACsAsggl",
                    "uid": null,
                    "url": null,
                    "type": "services",
                    "href": "https://zaheb.cdn.prismic.io/api/v2/documents/search?ref=aEXiXRUAAC8AshAf&q=%5B%5B%3Ad+%3D+at%28document.id%2C+%22aEXc6hUAACsAsggl%22%29+%5D%5D",
                    "tags": [],
                    "first_publication_date": "2025-06-08T19:10:27+0000",
                    "last_publication_date": "2025-06-08T19:19:57+0000",
                    "slugs": [
                        "services"
                    ],
                    "linked_documents": [],
                    "lang": "en-us",
                    "alternate_languages": [],
                    "data": {
                        "tittle_page": [
                            {
                                "type": "heading1",
                                "text": "Our Services...",
                                "spans": [],
                                "direction": "ltr"
                            }
                        ],
                        "tittle_paragraph": [
                            {
                                "type": "heading1",
                                "text": "Comprehensive Travel Solutions..",
                                "spans": [],
                                "direction": "ltr"
                            }
                        ],
                        "paragraph_text": [
                            {
                                "type": "heading1",
                                "text": "At Zaheb International, we offer a wide range of travel and visa services designed to make your journey smooth and hassle-free. Our experienced team is dedicated to providing personalized solutions tailored to your specific needs.",
                                "spans": [],
                                "direction": "ltr"
                            }
                        ],
                        "header_navigation": [
                            {
                                "nav_label": "home",
                                "nav_link": {
                                    "link_type": "Any"
                                }
                            },
                            {
                                "nav_label": "about",
                                "nav_link": {
                                    "link_type": "Any"
                                }
                            },
                            {
                                "nav_label": "service",
                                "nav_link": {
                                    "link_type": "Any"
                                }
                            },
                            {
                                "nav_label": "contact",
                                "nav_link": {
                                    "link_type": "Any"
                                }
                            }
                        ],
                        "our_services_title": null,
                        "services": [
                            {
                                "img_of_services": {
                                    "dimensions": {
                                        "width": 4380,
                                        "height": 2901
                                    },
                                    "alt": "orange fruit in water with water",
                                    "copyright": null,
                                    "url": "https://images.unsplash.com/photo-1582789760972-c8916cebe649?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzMzc0NjN8MHwxfHNlYXJjaHwxOHx8Y2l0cnVzJTIwZnJ1aXR8ZW58MHx8fHwxNzQ5MzY0OTMzfDA&ixlib=rb-4.1.0&q=85",
                                    "id": "uYM_PQJ8VvY",
                                    "edit": {
                                        "x": 0,
                                        "y": 0,
                                        "zoom": 1,
                                        "background": "transparent"
                                    }
                                },
                                "service_title": "Visa Processing",
                                "service_description": [
                                    {
                                        "type": "paragraph",
                                        "text": "We provide comprehensive visa processing services for various countries including Schengen countries, USA, Canada, UK, Australia, and many more. Our team of visa experts will guide you through the entire application process, ensuring that your visa application is complete, accurate, and submitted on time",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "key_benefits_tittle": [
                                    {
                                        "type": "heading1",
                                        "text": "k b",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_key_benefits": [
                                    {
                                        "type": "list-item",
                                        "text": "Expert guidance on visa requirements and documentation",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Higher success rate for visa approvals",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Time-saving and stress-free application process",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Regular updates on application status",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Assistance with visa interview preparation\n",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "how_it_works_tittle": [
                                    {
                                        "type": "heading1",
                                        "text": "h w",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_how_it_works": [
                                    {
                                        "type": "list-item",
                                        "text": "Contact us for a free consultation",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Submit required documents",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Our experts process your application",
                                        "spans": [],
                                        "direction": "ltr"
                                    },
                                    {
                                        "type": "list-item",
                                        "text": "Receive your visa",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_cta_label": "get visa",
                                "service_cta_link": {
                                    "link_type": "Web",
                                    "key": "b39ec5d0-9ba7-48c8-9ce9-aecd456d2e15",
                                    "url": "file:///C:/Users/zemax/Desktop/zaheb/visa.html"
                                }
                            },
                            {
                                "img_of_services": {
                                    "dimensions": {
                                        "width": 3024,
                                        "height": 4032
                                    },
                                    "alt": "orange fruit on white ceramic plate",
                                    "copyright": null,
                                    "url": "https://images.unsplash.com/photo-1616679312958-a86d9539afae?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzMzc0NjN8MHwxfHNlYXJjaHw0fHxjaXRydXMlMjBmcnVpdHxlbnwwfHx8fDE3NDkzNjQ5MzN8MA&ixlib=rb-4.1.0&q=85",
                                    "id": "Jr7t5QviCDM",
                                    "edit": {
                                        "x": 0,
                                        "y": 0,
                                        "zoom": 1,
                                        "background": "transparent"
                                    }
                                },
                                "service_title": "wwww",
                                "service_description": [
                                    {
                                        "type": "paragraph",
                                        "text": "ww",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "key_benefits_tittle": [
                                    {
                                        "type": "heading1",
                                        "text": "ww",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_key_benefits": [
                                    {
                                        "type": "paragraph",
                                        "text": "ww",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "how_it_works_tittle": [
                                    {
                                        "type": "heading1",
                                        "text": "ww",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_how_it_works": [
                                    {
                                        "type": "paragraph",
                                        "text": "ww",
                                        "spans": [],
                                        "direction": "ltr"
                                    }
                                ],
                                "service_cta_label": "ww",
                                "service_cta_link": {
                                    "link_type": "Any"
                                }
                            }
                        ],
                        "footer_text": "footer",
                        "footer_quick_links": [
                            {
                                "quick_link_label": "me",
                                "quick_link_url": {
                                    "link_type": "Any"
                                }
                            },
                            {
                                "quick_link_label": "me",
                                "quick_link_url": {
                                    "link_type": "Any"
                                }
                            }
                        ],
                        "footer_contact_info": []
                    }
                }
            ],
            "version": "21451f4",
            "license": "All Rights Reserved"
        };

        console.log("API response:", docsData);

        if (!docsData.results || docsData.results.length === 0) {
            console.error('No services page data found, using fallback content');
            displayFallbackContent();
            const loadingIndicator = document.querySelector('.loading-indicator');
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            return;
        }

        const doc = docsData.results[0];
        console.log("Services data loaded:", doc.data);

        // Update page content with API data
        updatePageTitle(doc.data);
        updateIntroSection(doc.data);
        updateServices(doc.data);
        updateFooter(doc.data);

        // Hide loading indicator
        const loadingIndicator = document.querySelector('.loading-indicator');
        if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
        }

    } catch (err) {
        console.error('Error processing services data:', err);
        displayFallbackContent();
        const loadingIndicator = document.querySelector('.loading-indicator');
        if (loadingIndicator) {
            loadingIndicator.style.display = 'none';
        }
    }
}

function updatePageTitle(data) {
    const pageTitle = document.querySelector('.container h1');
    if (pageTitle && data.tittle_page && data.tittle_page.length > 0) {
        const title = data.tittle_page[0]?.text || '';
        if (title) {
            pageTitle.textContent = title;
        }
    }
}

function updateIntroSection(data) {
    // Update intro title
    const introTitle = document.querySelector('.services-intro .section-title');
    if (introTitle && data.tittle_paragraph && data.tittle_paragraph.length > 0) {
        const title = data.tittle_paragraph[0]?.text || '';
        if (title) {
            introTitle.textContent = title;
        }
    }

    // Update intro paragraph
    const introParagraph = document.querySelector('.services-intro .lead');
    if (introParagraph && data.paragraph_text && data.paragraph_text.length > 0) {
        const text = data.paragraph_text[0]?.text || '';
        if (text) {
            introParagraph.textContent = text;
        }
    }
}

function updateServices(data) {
    if (!data.services || data.services.length === 0) {
        return;
    }

    // Get the services container
    const servicesContainer = document.getElementById('services-container');

    // Clear any existing content
    servicesContainer.innerHTML = '';

    // Update each service with data from API
    data.services.forEach((service, index) => {
        // Create a new section for each service from the API
        const serviceSection = document.createElement('section');
        serviceSection.className = 'service-detail';
        serviceSection.id = `service-${index}`;

        // Get service image URL
        const imageUrl = service.img_of_services?.url || 'images/visa-service.jpg';

        // Create service HTML structure
        serviceSection.innerHTML = `
            <div class="container">
                <div class="row">
                    <div class="service-image fade-in">
                        <img src="${imageUrl}" alt="${service.service_title}" class="glass-card">
                    </div>
                    <div class="service-content glass-card fade-in">
                        <h2>${service.service_title || ''}</h2>
                        <p>${service.service_description && service.service_description.length > 0 ? service.service_description[0].text : ''}</p>

                        <div class="service-benefits">
                            <h3>${service.key_benefits_tittle && service.key_benefits_tittle.length > 0 ? service.key_benefits_tittle[0].text : 'Key Benefits'}</h3>
                            <ul class="benefits-list">
                                ${generateBenefitsList(service.service_key_benefits)}
                            </ul>
                        </div>

                        <div class="service-steps">
                            <h3>${service.how_it_works_tittle && service.how_it_works_tittle.length > 0 ? service.how_it_works_tittle[0].text : 'How It Works'}</h3>
                            <ol class="steps-list">
                                ${generateStepsList(service.service_how_it_works)}
                            </ol>
                        </div>

                        <a href="${service.service_cta_link?.url || 'contact.html'}" class="btn btn-primary">${service.service_cta_label || 'Get Started'}</a>
                    </div>
                </div>
            </div>
        `;

        // Add the new section to the container
        servicesContainer.appendChild(serviceSection);
    });
}

function generateBenefitsList(benefits) {
    if (!benefits || benefits.length === 0) {
        return '<li>Professional service</li>';
    }

    return benefits.map(benefit => {
        if (benefit.type === 'list-item') {
            return `<li>${benefit.text || ''}</li>`;
        } else if (benefit.type === 'paragraph') {
            return `<li>${benefit.text || ''}</li>`;
        }
        return '';
    }).join('');
}

function generateStepsList(steps) {
    if (!steps || steps.length === 0) {
        return '<li>Contact us for details</li>';
    }

    return steps.map(step => {
        if (step.type === 'list-item') {
            return `<li>${step.text || ''}</li>`;
        } else if (step.type === 'paragraph') {
            return `<li>${step.text || ''}</li>`;
        }
        return '';
    }).join('');
}

function updateFooter(data) {
    // Update footer text
    const footerText = document.querySelector('.footer-logo p');
    if (footerText && data.footer_text) {
        footerText.textContent = data.footer_text;
    }

    // Update footer links
    if (data.footer_quick_links && data.footer_quick_links.length > 0) {
        const footerLinks = document.querySelector('.footer-links ul');
        if (footerLinks) {
            // Clear existing links
            footerLinks.innerHTML = '';

            // Add links from API
            data.footer_quick_links.forEach(link => {
                const label = link.quick_link_label || '';
                const url = link.quick_link_url?.url || '#';

                const li = document.createElement('li');
                li.innerHTML = `<a href="${url}">${label}</a>`;
                footerLinks.appendChild(li);
            });
        }
    }

    // Update navigation links
    if (data.header_navigation && data.header_navigation.length > 0) {
        const navList = document.querySelector('.nav-list');
        if (navList) {
            // Keep language switcher
            const langSwitcher = navList.querySelector('.mobile-lang');

            // Clear existing nav items except language switcher
            const navItems = navList.querySelectorAll('.nav-item:not(.mobile-lang)');
            navItems.forEach(item => {
                item.remove();
            });

            // Add navigation items from API
            data.header_navigation.forEach((item, index) => {
                const label = item.nav_label || '';
                const url = item.nav_link?.url || `${label.toLowerCase()}.html`;

                const li = document.createElement('li');
                li.className = 'nav-item';

                const isActive = window.location.pathname.includes(label.toLowerCase());

                li.innerHTML = `<a href="${url}" class="nav-link${isActive ? ' active' : ''}">${label}</a>`;

                // Insert before language switcher
                if (langSwitcher) {
                    navList.insertBefore(li, langSwitcher);
                } else {
                    navList.appendChild(li);
                }
            });
        }
    }
}

// Display fallback content when API fails
function displayFallbackContent() {
    // No need to implement fallback content as the HTML already has content
    console.log('Using existing HTML content as fallback');
}

// Update navigation links to preserve language parameter
function updateNavigationLinks() {
    // Get current language code from URL
    const urlParams = new URLSearchParams(window.location.search);
    const langCode = urlParams.get('lang');

    // If no language parameter is set, don't modify links
    if (!langCode) return;

    // Get all navigation links
    const navLinks = document.querySelectorAll('a[href]');

    navLinks.forEach(link => {
        const href = link.getAttribute('href');

        // Skip external links and anchor links
        if (href.startsWith('http') || href.startsWith('#') || href === '') return;

        // Parse the URL
        try {
            // For relative URLs, create a dummy absolute URL to parse
            const baseUrl = window.location.origin + window.location.pathname;
            const absoluteUrl = new URL(href, baseUrl);

            // Add language parameter
            absoluteUrl.searchParams.set('lang', langCode);

            // Get the path and query string
            const newHref = absoluteUrl.pathname + absoluteUrl.search;

            // Update the link
            link.setAttribute('href', newHref);
        } catch (e) {
            console.error('Error updating link:', e);
        }
    });
}

document.addEventListener('DOMContentLoaded', function () {
    fetchServicesData();
    updateNavigationLinks();
}); 